function showMessage(e,t){$("#fixedLogMsj").text(e).css({color:"white",background:t}).fadeIn("slow",function(){setTimeout(function(){$("#fixedLogMsj").fadeOut("slow")},2500)})}var serverAddress="localhost",serverPort="8082";$(function(){$(window).on("click touchstart",function(e){!$(e.target).is("#fixedEditButtons *")&&$("#fixedEditSubButtons").is(":visible")&&($("#fixedEditSubSubButtons").fadeOut("slow"),$("#fixedEditSubButtons").fadeOut("slow")),!$(e.target).is("#fixedEditMenu, #fixedEditMenu *, #fixedEditButtons *")&&$("#fixedEditMenu").is(":visible")&&($("#fixedLeftover").fadeOut("slow"),$("#fixedEditMenu").fadeOut("slow")),!$(e.target).is("#fixedStatsMenu, #fixedStatsMenu *, #fixedStatsButton")&&$("#fixedStatsMenu").is(":visible")&&($("#fixedLeftover").fadeOut("slow"),$("#fixedStatsMenu").fadeOut("slow"))}),$(window).on("resize",function(){$("#fixedEditMenu").css({left:(window.innerWidth-$("#fixedEditMenu").width())/2}),$("#fixedStatsMenu").css({left:(window.innerWidth-$("#fixedStatsMenu").width())/2}),$(".scroll").perfectScrollbar("update")})});var introMenu;$(function(){function e(){this.show=function(){$.ajax({url:"http://"+serverAddress+":"+serverPort+"/api/info?type=tree",method:"GET",success:function(t,n){e(t),i()},error:function(e,t,i){i?showMessage(e.responseText,"red"):showMessage("Unable to connect to server","red")}})};var e=function(e){for(var t="",i=0;i<e.length;i++){t+="<h2 id='"+e[i]._id+"' class='introUser' title='user "+e[i].name+"'>"+e[i].name+"</h2>";for(var n=0;n<e[i].languages.length;n++)t+="<button id='"+e[i].languages[n]._id+"' class='introLanguage' title='language "+e[i].languages[n].name+"'>"+e[i].languages[n].name+"</button>"}""===t&&(t="<h2 class='noInfo' title='no info to display'>No information to display</h2>"),$("#introContainer *").remove(),$(t).appendTo("#introContainer"),$("#introContainer").fadeIn(0),$(".scroll").perfectScrollbar("update")},i=function(){$("#introContainer .introLanguage").off().on("click touchstart",function(e){$.ajax({url:"http://"+serverAddress+":"+serverPort+"/api/session?language="+e.target.id,method:"GET",success:function(i,n){(new t).start(e.target.id,i)},error:function(e,t,i){i?showMessage(e.responseText,"red"):showMessage("Unable to connect to server","red")}})})}}function t(){var e,t,i,n=/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/gi,o=/(<[A-Z\/]*>|[¡!¿?\/|"'(){}<>@#$%^&*ºª=+·.,;:_\\\[\]\-\s\t\v])/gi,r=/aa|ii|uu|ee|oo|au|iu|eu|ou/gi,s={aa:"ā",ii:"ī",uu:"ū",ee:"ē",oo:"ō",au:"ā",iu:"ī",eu:"ē",ou:"ō"};this.start=function(n,o){e=o,t=n,i=0,d(),$("#introContainer, #fixedEditButtons, #fixedStatsButton").fadeOut("fast",function(){$("#quizContainer, #fixedExit, #fixedLoadingBar").fadeIn("slow"),setTimeout(function(){$("#quizContainer").scrollTop(0),$(".scroll").perfectScrollbar("update")},10)}),$("#fixedLoadingBarProgress").css("width",(100*(i+1)/e.length).toString()+"%"),window.onbeforeunload=f};var d=function(){var t=e[i].fields[e[i].fields.length-1],n=t.indexOf("(");n!=-1?($("#quizTranslate").text(t.charAt(0).toUpperCase()+t.substring(1,n).trim()),$("#quizDescription").text(t.substring(n).trim())):($("#quizTranslate").text(t.charAt(0).toUpperCase()+t.substring(1).trim()),$("#quizDescription").text("")),$("#quizTranslation").val("")},a=function(t){var o=e[i].fields,d="";d+=n.test(o[0])||n.test(o[0])?"<p class='fileTextBig'>"+o[0]+"</p>":"<p class='fileTextMed'>"+o[0].charAt(0).toUpperCase()+o[0].substring(1).trim()+"</p>";for(var a=1;a<o.length;a++)d+="<p>"+o[a]+"</p>";t||(d+="<p class='fileTextWrong'>"+$("#quizTranslation").val().toLowerCase().trim().replace(r,function(e){return s[e]})+"</p>"),$("#fileText p").remove(),$(d).appendTo("#fileText"),t?($("#fileButtonRight").fadeIn(0),$("#fileButtonWrong").fadeIn(0),$("#fileButtonContinue").fadeOut(0)):($("#fileButtonRight").fadeOut(0),$("#fileButtonWrong").fadeOut(0),$("#fileButtonContinue").fadeIn(0)),$("#quizContainer").fadeOut(0,function(){$("#fileContainer").fadeIn(0),setTimeout(function(){$("#fileContainer").scrollTop(0),$(".scroll").perfectScrollbar("update")},10)})},u=function(t){++i==e.length||t?($("#quizContainer, #fileContainer, #fixedExit, #fixedLoadingBar").fadeOut(0,function(){$("#introContainer, #fixedEditButtons, #fixedStatsButton").fadeIn("slow")}),window.onbeforeunload=l):(d(),$("#fileContainer").fadeOut(0,function(){$("#quizContainer").fadeIn(0),setTimeout(function(){$("#quizContainer").scrollTop(0),$(".scroll").perfectScrollbar("update")},10)}))},f=function(){return""},l=function(){};$("#quizForm").off().on("submit",function(t){t.preventDefault();for(var n=$("#quizTranslation").val().toLowerCase().replace(r,function(e){return s[e]}).replace(o,""),d=e[i].fields.slice(0,e[i].fields.length-1),u=0;u<d.length;u++)d[u]=d[u].toLowerCase().replace(r,function(e){return s[e]}).replace(o,"");if(d.indexOf(n)!=-1)a(!0);else{for(var f=n.split("").sort().join(""),l=new Array,u=0;u<d.length;u++)l[l.length]=d[u].split("").sort().join("");a(l.indexOf(f)!=-1?!0:!1)}}),$("#fileButtons button").off().on("click touchstart",function(n){n.preventDefault();var o;"fileButtonRight"==n.target.id?(o=!0,$("#fixedLoadingBarProgress").animate({width:(100*(i+2)/e.length).toString()+"%"},1e3)):(o=!1,e[e.length]=e[i]),i==e.indexOf(e[i])?$.ajax({url:"http://"+serverAddress+":"+serverPort+"/api/session?language="+t+"&word="+e[i]._id+"&state="+o,method:"POST",success:function(e,t){u()},error:function(e,t,i){i?showMessage(e.responseText,"red"):showMessage("Unable to connect to server","red")}}):u()}),$("#fixedExit").off().on("click touchstart",function(e){confirm("You are leaving without finishing the session, are you sure? You can resume the session later")&&u(!0)})}introMenu=new e,introMenu.show()}),$(function(){function e(){var e="";if(e+="<form id='fixedEditMenuForm'>",e+="<h2 id='fixedEditMenuTitle'>"+$("#"+r).val()+" "+$("#"+o).val()+"</h2>","fixedEditAdd"===r)switch(o){case"fixedEditUser":e+="<input id='fixedEditMenuInputUser' type='text' maxlength='20' placeholder='New user' autocomplete='on' required autofocus>";break;case"fixedEditLang":e+="<select id='fixedEditMenuSelectUser' required><option>Users</option></select>",e+="<input id='fixedEditMenuInputLang' type='text' maxlength='20' placeholder='New language' autocomplete='on' required>",e+="<input id='fixedEditMenuInputNumb' type='number' min='1' placeholder='Period length' required>";break;case"fixedEditWord":e+="<select id='fixedEditMenuSelectUser' required><option>Users</option></select>",e+="<select id='fixedEditMenuSelectLang' required><option>Languages</option></select>",e+="<textarea id='fixedEditMenuInputWord' name='textarea' dirname='textarea.dir' placeholder='New words (one word for each line and fields separated with &quot;&semi;&quot;)' required></textarea>"}else if("fixedEditRemove"===r)switch(o){case"fixedEditUser":e+="<select id='fixedEditMenuSelectUser' required><option>Users</option></select>";break;case"fixedEditLang":e+="<select id='fixedEditMenuSelectUser' required><option>Users</option></select>",e+="<select id='fixedEditMenuSelectLang' required><option>Languages</option></select>";break;case"fixedEditWord":e+="<select id='fixedEditMenuSelectUser' required><option>Users</option></select>",e+="<select id='fixedEditMenuSelectLang' required><option>Languages</option></select>",e+="<select id='fixedEditMenuSelectWord' required><option>Words</option></select>"}i("users","","#fixedEditMenuSelectUser"),e+="<button id='fixedEditMenuSubmit' class='icon-continue icon' type='submit' title='send form'></button>",e+="</form>",$("#fixedEditMenuForm").remove(),$(e).appendTo("#fixedEditMenu"),$("#fixedEditMenu").css({left:(window.innerWidth-$("#fixedEditMenu").width())/2}),$("#fixedLeftover").fadeIn("slow"),$("#fixedEditMenu").fadeIn("slow"),setTimeout(function(){$("#fixedEditMenu").scrollTop(0),$(".scroll").perfectScrollbar("update"),t()},10)}function t(){$("#fixedEditMenuSelectUser").off().on("change",function(e){$(s)[0].id&&(this[0].id||this[0].remove(),$("#fixedEditMenuSelectWord option").remove(),$("<option>Words</option>").appendTo("#fixedEditMenuSelectWord"),i("languages",$(s)[0].id,"#fixedEditMenuSelectLang"))}),$("#fixedEditMenuSelectLang").off().on("change",function(e){$(s)[1].id&&(this[0].id||this[0].remove(),i("words",$(s)[1].id,"#fixedEditMenuSelectWord"))}),$("#fixedEditMenuSelectWord").off().on("change",function(e){$(s)[2].id&&(this[0].id||this[0].remove())}),$("#fixedEditMenuForm").off().on("submit",function(e){e.preventDefault();var t=$(s);if(t[0]&&!t[0].id)showMessage("Undefined user","red");else if(t[1]&&!t[1].id)showMessage("Undefined language","red");else if(t[2]&&!t[2].id)showMessage("Undefined word","red");else{var i=new Object;if(i.type=$("#"+o).val(),"fixedEditAdd"===r){switch(o){case"fixedEditUser":i.user=$("#fixedEditMenuInputUser").val().trim().toLowerCase().replace(/\s\s+/g," ");break;case"fixedEditLang":i.user=t[0].id,i.language=$("#fixedEditMenuInputLang").val().trim().toLowerCase().replace(/\s\s+/g," "),i.period=$("#fixedEditMenuInputNumb").val();break;case"fixedEditWord":i.language=t[1].id,i.word=new Array;for(var d=$("#fixedEditMenuInputWord").val().split("\n"),a=0;a<d.length;a++){i.word[a]={fields:d[a].split(";")};for(var u=0;u<i.word[a].fields.length;u++)i.word[a].fields[u]=i.word[a].fields[u].trim().toLowerCase().replace(/\s\s+/g," ")}}n(i,"POST")}else if("fixedEditRemove"===r){var f;switch(o){case"fixedEditUser":i.user=t[0].id,f="You are attempting to delete the user '"+t[0].value+"' and all its content, are you sure?";break;case"fixedEditLang":i.language=t[1].id,f="You are attempting to delete the language '"+t[1].value+"' of user '"+t[0].value+"' and all its content, are you sure?";break;case"fixedEditWord":i.language=t[1].id,i.word=t[2].id}("fixedEditWord"==o||confirm(f))&&n(i,"DELETE")}}})}function i(e,t,i){$.ajax({url:"http://"+serverAddress+":"+serverPort+"/api/info?type="+e+"&id="+t,method:"GET",success:function(t,n){var o="<option>"+e+"</option>";if("words"===e){t=t.dictionary,t.sort(function(e,t){var i=/(<[A-Z\/]*>|[¡!¿?\/|"'(){}<>@#$%^&*ºª=+·.,;:_\\\[\]\-\s\t\v])/gi,n=/[A-Záàäâãåąæāéèëêęėēíïìîįīóòöôõøœōúüùûū]/gi,e=e.fields[e.fields.length-1].toLowerCase().replace(i,""),t=t.fields[t.fields.length-1].toLowerCase().replace(i,"");return isNaN(e.substring(0,1))||isNaN(t.substring(0,1))?e.localeCompare(t):e.replace(n,"")-t.replace(n,"")});for(var r=0;r<t.length;r++){for(var s="",d=t[r].fields.length-1;d;d--)s+=t[r].fields[d]+" <strong>&#92;</strong> ";s+=t[r].fields[0],o+="<option id='"+t[r]._id+"' value='"+s+"'>"+s+"</option>"}}else for(var r=0;r<t.length;r++)o+="<option id='"+t[r]._id+"' value='"+t[r].name+"'>"+t[r].name+"</option>";$(i+" option").remove(),$(o).appendTo(i)},error:function(e,t,i){i?showMessage(e.responseText,"red"):showMessage("Unable to connect to server","red")}})}function n(e,t){$.ajax({url:"http://"+serverAddress+":"+serverPort+"/api/info",method:t,contentType:"application/json",data:JSON.stringify(e),success:function(e,t){showMessage(e,"green"),$("#fixedLeftover").fadeOut("slow"),$("#fixedEditMenu").fadeOut("slow"),introMenu.show()},error:function(e,t,i){i?showMessage(e.responseText,"red"):showMessage("Unable to connect to server","red")}})}var o,r,s="#fixedEditMenuForm option:selected";$("#fixedEditTrigger").on("click touchstart",function(e){e.preventDefault(),$("#fixedEditSubButtons").is(":hidden")?$("#fixedEditSubButtons").fadeIn("slow"):($("#fixedEditSubSubButtons").fadeOut("slow"),$("#fixedEditSubButtons").fadeOut("slow"))}),$("#fixedEditSubButtons .subButton").on("click touchstart",function(e){switch(e.preventDefault(),e.target.id){case"fixedEditUser":$("#fixedEditSubSubButtons .subSubButton").animate({top:"55px"});break;case"fixedEditLang":$("#fixedEditSubSubButtons .subSubButton").animate({top:"95px"});break;case"fixedEditWord":$("#fixedEditSubSubButtons .subSubButton").animate({top:"135px"})}$("#fixedEditSubSubButtons").is(":hidden")?$("#fixedEditSubSubButtons").fadeIn("slow"):o==e.target.id&&$("#fixedEditSubSubButtons").fadeOut("slow"),o=e.target.id}),$("#fixedEditSubSubButtons .subSubButton").on("click touchstart",function(t){t.preventDefault(),$("#fixedEditSubButtons").is(":visible")&&($("#fixedEditSubSubButtons").fadeOut("slow"),$("#fixedEditSubButtons").fadeOut("slow")),r=t.target.id,e()})}),$(function(){function e(){t("users","","#fixedStatsMenuSelectUser"),$("#fixedStatsMenuSelectLang option").remove(),$("<option>languages</option>").appendTo("#fixedStatsMenuSelectLang"),$("#fixedStatsMenu").css({left:(window.innerWidth-$("#fixedStatsMenu").width())/2}),$("#fixedLeftover").fadeIn("slow"),$("#fixedStatsMenu").fadeIn("slow"),setTimeout(function(){$("#fixedStatsMenu").scrollTop(0),$(".scroll").perfectScrollbar("update")},10)}function t(e,t,i){$.ajax({url:"http://"+serverAddress+":"+serverPort+"/api/info?type="+e+"&id="+t,method:"GET",success:function(t,n){for(var o="<option>"+e+"</option>",r=0;r<t.length;r++)o+="<option id='"+t[r]._id+"' value='"+t[r].name+"'>"+t[r].name+"</option>";$(i+" option").remove(),$(o).appendTo(i)},error:function(e,t,i){i?showMessage(e.responseText,"red"):showMessage("Unable to connect to server","red")}})}function i(e){$.ajax({url:"http://"+serverAddress+":"+serverPort+"/api/info?type=words&id="+e,method:"GET",success:function(e,t){n(e)},error:function(e,t,i){i?showMessage(e.responseText,"red"):showMessage("Unable to connect to server","red")}})}function n(e){var t,i=/(<[A-Z\/]*>|[¡!¿?\/|"'(){}<>@#$%^&*ºª=+·.,;:_\\\[\]\-\s\t\v])/gi,n=/[A-Záàäâãåąæāéèëêęėēíïìîįīóòöôõøœōúüùûū]/gi,o=/([0-9áàäâãåąæāéèëêęėēíïìîįīóòöôõøœōúüùûū])/gi,r="<h3>"+e.dictionary.length+" words</h3><h3>"+e.period.current+"/"+ ++e.period.length+" sessions</h3><h3>"+new Date(e.session.date).toLocaleDateString()+"</h3><h3>"+new Date(e.date).toLocaleDateString()+"</h3>",s="<tr><th class='alignLeft'>Fields</th><th>Count</th><th>Countdown</th><th>Completed</th></tr>";e.dictionary.sort(function(e,t){var e=e.fields[e.fields.length-1].toLowerCase().replace(i,""),t=t.fields[t.fields.length-1].toLowerCase().replace(i,"");return isNaN(e.substring(0,1))||isNaN(t.substring(0,1))?e.localeCompare(t):e.replace(n,"")-t.replace(n,"")});for(var d=0;d<e.dictionary.length;d++){var a=e.dictionary[d].fields[e.dictionary[d].fields.length-1].replace(i,"").substring(0,1).replace(o,"");a!=t&&""!=a&&(t=a,s+="<tr><td class='alignLeft letterSeparator' colspan='4'>"+t+"</td></tr>"),s+="<tr><td class='alignLeft'>";for(var u=e.dictionary[d].fields.length-1;u;u--)s+=e.dictionary[d].fields[u]+" <strong>&#92;</strong> ";s+=e.dictionary[d].fields[0]+"</td>",s+="<td>"+e.dictionary[d].count.correct+"/"+e.dictionary[d].count.wrong+"</td><td>"+e.dictionary[d].countdown.new+"/"+e.dictionary[d].countdown.wrong+"</td><td>"+e.dictionary[d].ref+"</td></tr>"}$("#fixedStatsMenuLanguage").text($("#fixedStatsMenuSelectLang").val()),$("#fixedStatsMenuInfo02 h3").remove(),$("#fixedStatsMenuTable tr").remove(),$(r).appendTo("#fixedStatsMenuInfo02"),$(s).appendTo("#fixedStatsMenuTable"),$("#fixedStatsMenu").animate({scrollTop:$("#fixedStatsMenuLanguage").position().top},1e3)}var o="#fixedStatsMenuForm option:selected";$("#fixedStatsButton").on("click touchstart",function(){e()}),$("#fixedStatsMenuSelectUser").off().on("change",function(){$(o)[0].id&&(this[0].id||this[0].remove(),t("languages",$(o)[0].id,"#fixedStatsMenuSelectLang"))}),$("#fixedStatsMenuSelectLang").off().on("change",function(e){$(o)[1].id&&(this[0].id||this[0].remove())}),$("#fixedStatsMenuForm").off().on("submit",function(e){e.preventDefault();var t=$(o);t[0].id?t[1].id?i(t[1].id):showMessage("Undefined language","red"):showMessage("Undefined user","red")})}),$(function(){$(".scroll").perfectScrollbar({minScrollbarLength:20})});