"use strict";function showMessage(e,t){$("#fixedLogMsj").text(e).css({color:"white",background:t}).fadeIn("slow",function(){setTimeout(function(){$("#fixedLogMsj").fadeOut("slow")},2500)})}function fadeOut(){document.getElementById("projectIntroContainer").classList.add("fadeOut"),setTimeout(()=>{document.getElementById("projectIntroContainer").style.display="none",document.body.classList.remove("noScroll")},500)}var introMenu,serverAddress="localhost",serverPort="8082";$(function(){$(window).on("click touchstart",function(e){$("#fixedEditSubButtons").is(":visible")&&!$(e.target).is("#fixedEditButtons *")&&$("#fixedEditSubSubButtons, #fixedEditSubButtons").fadeOut("slow"),!$("#fixedEditMenu").is(":visible")||$(e.target).is("#fixedEditMenu, #fixedEditMenu *, #fixedEditButtons *")&&!$(e.target).is(".exitButton")||$("#fixedLeftover, #fixedEditMenu").fadeOut("slow"),!$("#fixedStatsMenu").is(":visible")||$(e.target).is("#fixedStatsMenu, #fixedStatsMenu *, #fixedStatsButton")&&!$(e.target).is(".exitButton")||$("#fixedLeftover, #fixedStatsMenu").fadeOut("slow")}),$(window).on("resize",function(){$("#fixedEditMenu").css({left:(window.innerWidth-$("#fixedEditMenu").width())/2}),$("#fixedStatsMenu").css({left:(window.innerWidth-$("#fixedStatsMenu").width())/2}),$(".scroll").perfectScrollbar("update")})}),$(function(){function e(){this.show=function(){$.ajax({url:"http://"+serverAddress+":"+serverPort+"/info?type=tree",method:"GET",success:function(t,n){e(t),i()},error:function(e,t,i){showMessage(i?e.responseText:"Unable to connect to server","red")}})};var e=function(e){for(var t="",i=0;i<e.length;i++){t+="<h2 id='"+e[i]._id+"' class='introUser' title='user "+e[i].name+"'>"+e[i].name+"</h2>";for(var n=0;n<e[i].languages.length;n++)t+="<button id='"+e[i].languages[n]._id+"' class='introLanguage' title='language "+e[i].languages[n].name+"'>"+e[i].languages[n].name+"</button>"}""===t&&(t="<h2 class='noInfo' title='no info to display'>No information to display</h2>"),$("#introContainer h2, #introContainer button").remove(),$(t).appendTo("#introContainer"),$("#introContainer").fadeIn(0),setTimeout(function(){$("#introContainer").scrollTop(0),$(".scroll").perfectScrollbar("update")},10)},i=function(){$("#introContainer .introLanguage").off().on("click",function(e){$.ajax({url:"http://"+serverAddress+":"+serverPort+"/session?language="+e.target.id,method:"GET",success:function(i,n){(new t).start(e.target.id,i)},error:function(e,t,i){showMessage(i?e.responseText:"Unable to connect to server","red")}})})}}function t(){var e,t,i,n=/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/gi,o=/(<[A-Z\/]*>|[¡!¿?\/|"'(){}<>@#$%^&*ºª=+·.,;:_\\\[\]\s\t\v])/gi,s=/aa|ii|uu|ee|oo|au|iu|eu|ou/gi,r={aa:"ā",ii:"ī",uu:"ū",ee:"ē",oo:"ō",au:"ā",iu:"ī",eu:"ē",ou:"ō"},d=!1;this.start=function(n,o){e=o,t=n,i=0,a(),$("#introContainer, #fixedEditButtons, #fixedStatsButton").fadeOut("fast",function(){$("#quizContainer, #fixedExit, #fixedLoadingBar").fadeIn("slow"),setTimeout(function(){$("#quizContainer").scrollTop(0),$(".scroll").perfectScrollbar("update"),$("#quizTranslation").focus()},10)}),$("#fixedLoadingBarProgress").css("width",(100*(i+1)/e.length).toString()+"%"),window.onbeforeunload=l};var a=function(){var t=e[i].fields[e[i].fields.length-1],n=t.indexOf("(");t=t.charAt(0).toUpperCase()+t.substring(1),-1!=n?($("#quizTranslate").text(t.substring(0,n).trim()),$("#quizDescription").text(t.substring(n).trim())):($("#quizTranslate").text(t.trim()),$("#quizDescription").text("")),$("#quizTranslation").val("")},u=function(t){var o=e[i].fields,a="";n.test(o[0])||n.test(o[0])?a+="<p class='fileTextBig'>"+o[0]+"</p>":a+="<p class='fileTextMed'>"+o[0].charAt(0).toUpperCase()+o[0].substring(1).trim()+"</p>";for(var u=1;u<o.length;u++)a+="<p>"+o[u]+"</p>";t||(a+="<p class='fileTextWrong'>"+$("#quizTranslation").val().toLowerCase().trim().replace(s,function(e){return r[e]})+"</p>"),$("#fileText p").remove(),$(a).appendTo("#fileText"),t?($("#fileButtonRight").fadeIn(0),$("#fileButtonWrong").fadeIn(0),$("#fileButtonContinue").fadeOut(0)):($("#fileButtonRight").fadeOut(0),$("#fileButtonWrong").fadeOut(0),$("#fileButtonContinue").fadeIn(0)),$("#quizContainer").fadeOut(0,function(){$("#fileContainer").fadeIn(0),setTimeout(function(){$("#fileContainer").scrollTop(0),$(".scroll").perfectScrollbar("update"),t?$("#fileButtonRight").focus():$("#fileButtonContinue").focus()},10)}),d=!0,setTimeout(function(){d=!1},1e3)},f=function(t){++i==e.length||t?($("#quizContainer, #fileContainer, #fixedExit, #fixedLoadingBar").fadeOut(0,function(){$("#introContainer, #fixedEditButtons, #fixedStatsButton").fadeIn("slow")}),window.onbeforeunload=c):(a(),$("#fileContainer").fadeOut(0,function(){$("#quizContainer").fadeIn(0),setTimeout(function(){$("#quizContainer").scrollTop(0),$(".scroll").perfectScrollbar("update"),$("#quizTranslation").focus()},10)}),d=!0,setTimeout(function(){d=!1},1e3))},l=function(){return""},c=function(){};$("#quizForm").off().on("submit",function(t){if(t.preventDefault(),!d){for(var n=$("#quizTranslation").val().toLowerCase().replace(s,function(e){return r[e]}).replace(o,""),a=e[i].fields.slice(0,e[i].fields.length-1),f=0;f<a.length;f++)a[f]=a[f].toLowerCase().replace(s,function(e){return r[e]}).replace(o,"");if(-1!=a.indexOf(n))u(!0);else{var l=n.split("").sort().join(""),c=new Array;for(f=0;f<a.length;f++)c[c.length]=a[f].split("").sort().join("");-1!=c.indexOf(l)?u(!0):u(!1)}}}),$("#fileButtons button").off().on("click",function(n){var o;(n.preventDefault(),d)||("fileButtonRight"==n.target.id?(o=!0,$("#fixedLoadingBarProgress").animate({width:(100*(i+2)/e.length).toString()+"%"},1e3)):(o=!1,e[e.length]=e[i]),i==e.indexOf(e[i])?$.ajax({url:"http://"+serverAddress+":"+serverPort+"/session?language="+t+"&word="+e[i]._id+"&state="+o,method:"POST",success:function(e,t){f()},error:function(e,t,i){showMessage(i?e.responseText:"Unable to connect to server","red")}}):f())}),$("#fixedExit").off().on("click",function(e){confirm("You are leaving without finishing the session, are you sure? You can resume the session later")&&f(!0)})}introMenu=new e,introMenu.show()}),$(function(){function e(){var e="";if(e+="<form id='fixedEditMenuForm'>",e+="<h2 id='fixedEditMenuTitle'>"+$("#"+s).val()+" "+$("#"+o).val()+"</h2>","fixedEditAdd"===s)switch(o){case"fixedEditUser":e+="<input id='fixedEditMenuInputUser' type='text' maxlength='20' placeholder='New user' autocomplete='on' required autofocus>";break;case"fixedEditLang":e+="<select id='fixedEditMenuSelectUser' required><option>Users</option></select>",e+="<input id='fixedEditMenuInputLang' type='text' maxlength='20' placeholder='New language' autocomplete='on' required>",e+="<input id='fixedEditMenuInputNumb' type='number' min='1' placeholder='Period length' required>";break;case"fixedEditWord":e+="<select id='fixedEditMenuSelectUser' required><option>Users</option></select>",e+="<select id='fixedEditMenuSelectLang' required><option>Languages</option></select>",e+="<textarea id='fixedEditMenuInputWord' name='textarea' dirname='textarea.dir' placeholder='New words (one word for each line and fields separated with &quot;&semi;&quot;)' required></textarea>"}else if("fixedEditRemove"===s)switch(o){case"fixedEditUser":e+="<select id='fixedEditMenuSelectUser' required><option>Users</option></select>";break;case"fixedEditLang":e+="<select id='fixedEditMenuSelectUser' required><option>Users</option></select>",e+="<select id='fixedEditMenuSelectLang' required><option>Languages</option></select>";break;case"fixedEditWord":e+="<select id='fixedEditMenuSelectUser' required><option>Users</option></select>",e+="<select id='fixedEditMenuSelectLang' required><option>Languages</option></select>",e+="<select id='fixedEditMenuSelectWord' required><option>Words</option></select>"}i("users","","#fixedEditMenuSelectUser"),e+="<button id='fixedEditMenuSubmit' class='icon-continue icon' type='submit' title='send form'></button>",e+="</form>",$("#fixedEditMenuForm").remove(),$(e).appendTo("#fixedEditMenu"),$("#fixedEditMenu").css({left:(window.innerWidth-$("#fixedEditMenu").width())/2}),$("#fixedLeftover").fadeIn("slow"),$("#fixedEditMenu").fadeIn("slow"),setTimeout(function(){$("#fixedEditMenu").scrollTop(0),$(".scroll").perfectScrollbar("update"),t()},10)}function t(){$("#fixedEditMenuSelectUser").off().on("change",function(e){$(r)[0].id&&(this[0].id||this[0].remove(),$("#fixedEditMenuSelectWord option").remove(),$("<option>Words</option>").appendTo("#fixedEditMenuSelectWord"),i("languages",$(r)[0].id,"#fixedEditMenuSelectLang"))}),$("#fixedEditMenuSelectLang").off().on("change",function(e){$(r)[1].id&&(this[0].id||this[0].remove(),i("words",$(r)[1].id,"#fixedEditMenuSelectWord"))}),$("#fixedEditMenuSelectWord").off().on("change",function(e){$(r)[2].id&&(this[0].id||this[0].remove())}),$("#fixedEditMenuForm").off().on("submit",function(e){e.preventDefault();var t=$(r);if(t[0]&&!t[0].id)showMessage("Undefined user","red");else if(t[1]&&!t[1].id)showMessage("Undefined language","red");else if(t[2]&&!t[2].id)showMessage("Undefined word","red");else{var i=new Object;if(i.type=$("#"+o).val(),"fixedEditAdd"===s){switch(o){case"fixedEditUser":i.user=$("#fixedEditMenuInputUser").val().trim().toLowerCase().replace(/\s\s+/g," ");break;case"fixedEditLang":i.user=t[0].id,i.language=$("#fixedEditMenuInputLang").val().trim().toLowerCase().replace(/\s\s+/g," "),i.period=$("#fixedEditMenuInputNumb").val();break;case"fixedEditWord":i.language=t[1].id,i.word=new Array;for(var d=$("#fixedEditMenuInputWord").val().split("\n"),a=0;a<d.length;a++){i.word[a]={fields:d[a].split(";")};for(var u=0;u<i.word[a].fields.length;u++)i.word[a].fields[u]=i.word[a].fields[u].trim().toLowerCase().replace(/\s\s+/g," ")}}n(i,"POST")}else if("fixedEditRemove"===s){var f;switch(o){case"fixedEditUser":i.user=t[0].id,f="You are attempting to delete the user '"+t[0].value+"' and all its content, are you sure?";break;case"fixedEditLang":i.language=t[1].id,f="You are attempting to delete the language '"+t[1].value+"' of user '"+t[0].value+"' and all its content, are you sure?";break;case"fixedEditWord":i.language=t[1].id,i.word=t[2].id}("fixedEditWord"==o||confirm(f))&&n(i,"DELETE")}}})}function i(e,t,i){$.ajax({url:"http://"+serverAddress+":"+serverPort+"/info?type="+e+"&id="+t,method:"GET",success:function(t,n){var o="<option>"+e+"</option>";if("words"===e){t=t.dictionary,t.sort(function(e,t){var i=/(<[A-Z\/]*>|[¡!¿?\/|"'(){}<>@#$%^&*ºª=+·.,;:_\\\[\]\-\s\t\v])/gi,n=/[A-Záàäâãåąæāéèëêęėēíïìîįīóòöôõøœōúüùûū]/gi;e=e.fields[e.fields.length-1].toLowerCase().replace(i,""),t=t.fields[t.fields.length-1].toLowerCase().replace(i,"");return isNaN(e.substring(0,1))||isNaN(t.substring(0,1))?e.localeCompare(t):e.replace(n,"")-t.replace(n,"")});for(var s=0;s<t.length;s++){for(var r="",d=t[s].fields.length-1;d;d--)r+=t[s].fields[d]+" <strong>&#92;</strong> ";r+=t[s].fields[0],o+="<option id='"+t[s]._id+"' value='"+r+"'>"+r+"</option>"}}else for(s=0;s<t.length;s++)o+="<option id='"+t[s]._id+"' value='"+t[s].name+"'>"+t[s].name+"</option>";$(i+" option").remove(),$(o).appendTo(i)},error:function(e,t,i){showMessage(i?e.responseText:"Unable to connect to server","red")}})}function n(e,t){$.ajax({url:"http://"+serverAddress+":"+serverPort+"/info",method:t,contentType:"application/json",data:JSON.stringify(e),success:function(e,t){showMessage(e,"green"),$("#fixedLeftover").fadeOut("slow"),$("#fixedEditMenu").fadeOut("slow"),introMenu.show()},error:function(e,t,i){showMessage(i?e.responseText:"Unable to connect to server","red")}})}var o,s,r="#fixedEditMenuForm option:selected";$("#fixedEditTrigger").on("click",function(e){e.preventDefault(),$("#fixedEditSubButtons").is(":hidden")?$("#fixedEditSubButtons").fadeIn("slow"):($("#fixedEditSubSubButtons").fadeOut("slow"),$("#fixedEditSubButtons").fadeOut("slow"))}),$("#fixedEditSubButtons .subButton").on("click",function(e){switch(e.preventDefault(),e.target.id){case"fixedEditUser":$("#fixedEditSubSubButtons .subSubButton").animate({top:"55px"});break;case"fixedEditLang":$("#fixedEditSubSubButtons .subSubButton").animate({top:"95px"});break;case"fixedEditWord":$("#fixedEditSubSubButtons .subSubButton").animate({top:"135px"})}$("#fixedEditSubSubButtons").is(":hidden")?$("#fixedEditSubSubButtons").fadeIn("slow"):o==e.target.id&&$("#fixedEditSubSubButtons").fadeOut("slow"),o=e.target.id}),$("#fixedEditSubSubButtons .subSubButton").on("click",function(t){t.preventDefault(),$("#fixedEditSubButtons").is(":visible")&&($("#fixedEditSubSubButtons").fadeOut("slow"),$("#fixedEditSubButtons").fadeOut("slow")),s=t.target.id,e()})}),$(function(){function e(){t("users","","#fixedStatsMenuSelectUser"),$("#fixedStatsMenuSelectLang option").remove(),$("<option>languages</option>").appendTo("#fixedStatsMenuSelectLang"),$("#fixedStatsMenu").css({left:(window.innerWidth-$("#fixedStatsMenu").width())/2}),$("#fixedLeftover").fadeIn("slow"),$("#fixedStatsMenu").fadeIn("slow"),setTimeout(function(){$("#fixedStatsMenu").scrollTop(0),$(".scroll").perfectScrollbar("update")},10)}function t(e,t,i){$.ajax({url:"http://"+serverAddress+":"+serverPort+"/info?type="+e+"&id="+t,method:"GET",success:function(t,n){for(var o="<option>"+e+"</option>",s=0;s<t.length;s++)o+="<option id='"+t[s]._id+"' value='"+t[s].name+"'>"+t[s].name+"</option>";$(i+" option").remove(),$(o).appendTo(i)},error:function(e,t,i){showMessage(i?e.responseText:"Unable to connect to server","red")}})}function i(e){$.ajax({url:"http://"+serverAddress+":"+serverPort+"/info?type=words&id="+e,method:"GET",success:function(e,t){n(e)},error:function(e,t,i){showMessage(i?e.responseText:"Unable to connect to server","red")}})}function n(e){var t,i=/(<[A-Z\/]*>|[¡!¿?\/|"'(){}<>@#$%^&*ºª=+·.,;:_\\\[\]\-\s\t\v])/gi,n=/[A-Záàäâãåąæāéèëêęėēíïìîįīóòöôõøœōúüùûū]/gi,s=/([0-9áàäâãåąæāéèëêęėēíïìîįīóòöôõøœōúüùûū])/gi,r="<h3>"+e.dictionary.length+" words</h3><h3>"+e.period.current+"/"+ ++e.period.length+" sessions</h3><h3>"+new Date(e.session.date).toLocaleDateString()+"</h3><h3>"+new Date(e.date).toLocaleDateString()+"</h3>",d="<tr><th class='alignLeft' title='Fields column shows all the translation data of each word entered during its creation'>Fields</th><th title='Count column shows the hits and fails of each word'>Count</th><th title='Countdown column shows two special counts to solve each word in following consecutive sessions for being a new and/or failed word'>Countdown</th><th title='Completed column shows if each word is completed in the current period of sessions'>Completed</th></tr>";e.dictionary.sort(function(e,t){e=e.fields[e.fields.length-1].toLowerCase().replace(i,""),t=t.fields[t.fields.length-1].toLowerCase().replace(i,"");return isNaN(e.substring(0,1))||isNaN(t.substring(0,1))?e.localeCompare(t):e.replace(n,"")-t.replace(n,"")});for(var a=0;a<e.dictionary.length;a++){var u=e.dictionary[a].fields[e.dictionary[a].fields.length-1].replace(i,"").substring(0,1).replace(s,"");u!=t&&""!=u&&(t=u,d+="<tr><td class='alignLeft letterSeparator "+t.toLowerCase()+" "+t.toUpperCase()+"' colspan='4'>"+t+"</td></tr>"),d+="<tr><td class='alignLeft'>";for(var f=e.dictionary[a].fields.length-1;f;f--)d+=e.dictionary[a].fields[f]+" <strong>&#92;</strong> ";d+=e.dictionary[a].fields[0]+"</td>",d+="<td title='"+e.dictionary[a].count.correct+" hits&NewLine;"+e.dictionary[a].count.wrong+" failures'>"+e.dictionary[a].count.correct+"/"+e.dictionary[a].count.wrong+"</td><td title='"+e.dictionary[a].countdown.new+" following consecutive sessions in which to solve for being a new word&NewLine;"+e.dictionary[a].countdown.wrong+" following consecutive sessions in which to solve for being a failed word'>"+e.dictionary[a].countdown.new+"/"+e.dictionary[a].countdown.wrong+"</td>",e.dictionary[a].ref?d+="<td title='Word already completed in the current period of sessions'>"+e.dictionary[a].ref+"</td>":d+="<td title='Word not yet completed in the current period of sessions'>"+e.dictionary[a].ref+"</td>",d+="</tr>"}$("#fixedStatsMenuLanguage").text($("#fixedStatsMenuSelectLang").val()),$("#fixedStatsMenuInfo02 h3").remove(),$("#fixedStatsMenuTable tr").remove(),$(r).appendTo("#fixedStatsMenuInfo02"),$(d).appendTo("#fixedStatsMenuTable"),$("#fixedStatsMenuInfo").show(),$("#fixedStatsMenuTable").show(),$("#fixedStatsMenu").animate({scrollTop:$("#fixedStatsMenuLanguage").position().top},1e3),o()}function o(){$(document).off("keydown").keydown(function(e){$("#fixedStatsMenuTable").is(":visible")&&(e.which||e.keyCode)>=65&&(e.which||e.keyCode)<=90&&$(".letterSeparator."+String.fromCharCode(e.which||e.keyCode)).length&&$("#fixedStatsMenu").scrollTop(0).scrollTop($(".letterSeparator."+String.fromCharCode(e.which||e.keyCode)).position().top)})}var s="#fixedStatsMenuForm option:selected";$("#fixedStatsButton").on("click",function(){e()}),$("#fixedStatsMenuSelectUser").off().on("change",function(){$(s)[0].id&&(this[0].id||this[0].remove(),t("languages",$(s)[0].id,"#fixedStatsMenuSelectLang"))}),$("#fixedStatsMenuSelectLang").off().on("change",function(e){$(s)[1].id&&(this[0].id||this[0].remove())}),$("#fixedStatsMenuForm").off().on("submit",function(e){e.preventDefault();var t=$(s);t[0].id?t[1].id?i(t[1].id):showMessage("Undefined language","red"):showMessage("Undefined user","red")})}),$(function(){$(".scroll").perfectScrollbar({minScrollbarLength:20})}),document.body.classList.add("noScroll");const projectIntroText="Application for languages study focused on users adding the languages and content they wish to study, in addition to the period in which they want that content to be distributed.<br>A session is generated daily with the content that users should complete for that day, emphasizing the mistakes made in previous sessions.";document.getElementById("projectIntroText").innerHTML=projectIntroText,document.getElementById("projectIntroContent").style.maxWidth=document.getElementById("projectIntroImg").offsetWidth+"px",setTimeout(()=>{document.getElementById("projectIntroContent").style.maxWidth="900px"},500);